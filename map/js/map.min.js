"use strict";function initMap(){function i(){var i=[];return i.push({address:"3070 N Shoreline Blvd",description:"Rengstorff House",visible:!0}),i.push({address:"1600 Amphitheatre Pkwy",description:"Google",visible:!0}),i.push({address:"500 Castro St",description:"Mountain View City Hall",visible:!0}),i.push({address:"615 Cuesta Dr",description:"Cuesta Park",visible:!0}),i.push({address:"2500 Grant Rd",description:"El Camino Hospital",visible:!0}),i}map=new google.maps.Map(document.getElementById("map"),{center:{lat:37.415,lng:-122.081},scrollwheel:!0,zoom:13,disableDefaultUI:!0}),locations=i(),pinPoster(locations),ko.applyBindings(new PlacesViewModel)}function setMapOnAll(i){for(var e=0,t=locations.length;t>e;e++){var s=getFromMarkers(locations[e].address);locations[e].visible===!0&&markers[s].setMap(i)}}function clearLocs(){for(var i=0,e=locations.length;e>i;i++)locations[i].visible=!0}function clearMarkers(){setMapOnAll(null)}function getFromAddress(i){for(var e=0,t=locations.length;t>e;e++)if(i===locations[e].address)return e}function getFromMarkers(i){for(var e=0,t=markers.length;t>e;e++)if(i===markers[e].title)return e}function createInfoConent(i){var e="https://maps.googleapis.com/maps/api/streetview?size=600x400&location="+i+","+hood,t=getFromAddress(i),s='<div id="infoContent"><img class="bgimg" src="'+e+'"><h3 id="infoHeading" class="infoHeader">'+i+", "+hood+'</h3><div id="infoBody" class="infoBody">'+locations[t].description+'</div><h4>Wikipedia Link</h4><p id="wikipedia-links"></p></div>';return s}function getWiki(i){var e=getFromAddress(i.title),t=setTimeout(function(){$("#wikipedia-links").text("Something is wrong with wikipedia, please try again later.")},5e3);$.ajax({url:"https://en.wikipedia.org/w/api.php?action=opensearch&search="+locations[e].description+"&format=json&callback=wikiCallback",dataType:"jsonp",success:function(i){var e=i[1];if(0===e.length)$("#wikipedia-links").text("No article in wikipedia");else{var s="https://en.wikipedia.org/wiki/"+e[0];$("#wikipedia-links").append('<a href="'+s+'">'+s+"<a>")}clearTimeout(t)}})}function createMapMarker(i){var e=new google.maps.Marker({map:map,position:i.geometry.location,animation:google.maps.Animation.DROP,title:i.name});markers.push(e);var t=createInfoConent(i.name),s=new google.maps.InfoWindow({content:t,maxWidth:maxwidth});google.maps.event.addListener(e,"click",function(){getWiki(e),e.setAnimation(google.maps.Animation.BOUNCE),s.open(map,e),setTimeout(function(){e.setAnimation(null)},2e3)})}function callback(i,e){e==google.maps.places.PlacesServiceStatus.OK&&createMapMarker(i[0])}function pinPoster(i){var e=new google.maps.places.PlacesService(map);for(var t in i){if(i[t].visible===!0)var s={query:i[t].address+hood};e.textSearch(s,callback)}}var locations,map,hood="Mountain View, CA",markers=[],maxwidth=300,PlacesViewModel=function(){this.items=ko.observableArray([]),this.itemToAdd=ko.observable(""),this.ctrls=ko.observable(!1),this.controlsToggle=ko.pureComputed(function(){return this.ctrls()===!1?"open":"controlsClosed"},this),this.toggleControls=function(){return this.ctrls(!this.ctrls()),!0},this.init=function(){this.items.push(locations[0].address),this.items.push(locations[1].address),this.items.push(locations[2].address),this.items.push(locations[3].address),this.items.push(locations[4].address)},this.clear=function(){for(var i in this.items)this.items.pop()},this.addItem=function(){if(clearMarkers(),this.clear(),""!=this.itemToAdd())for(var i=0;i<locations.length;i++){var e=this.itemToAdd().toString(),t=locations[i].address.search(new RegExp(e,"i"));-1!=t?(this.items.push(locations[i].address),locations[i].visible=!0):locations[i].visible=!1}else this.init(),clearLocs();setMapOnAll(map)}.bind(this),this.showInfo=function(){var i=$("#filter-box option:selected")[0].text,e=getFromMarkers(i),t=createInfoConent(i),s=new google.maps.InfoWindow({content:t,maxWidth:maxwidth});s.open(map,markers[e]),getWiki(markers[e])},this.init()};