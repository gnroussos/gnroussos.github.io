"use strict";function initMap(){function i(){var i=[];return i.push({address:"3070 N Shoreline Blvd",description:"Rengstorff House",visible:!0}),i.push({address:"1600 Amphitheatre Pkwy",description:"Google",visible:!0}),i.push({address:"500 Castro St",description:"Mountain View City Hall",visible:!0}),i.push({address:"615 Cuesta Dr",description:"Cuesta Park",visible:!0}),i.push({address:"2500 Grant Rd",description:"El Camino Hospital",visible:!0}),i}map=new google.maps.Map(document.getElementById("map"),{center:{lat:37.409,lng:-122.081},scrollwheel:!0,zoom:13,disableDefaultUI:!0}),locations=i(),pinPoster(locations)}function setMapOnAll(i){for(var e=0,s=locations.length;s>e;e++){var t=getFromMarkers(locations[e].address);locations[e].visible===!0&&markers[t].setMap(i)}}function clearLocs(){for(var i=0,e=locations.length;e>i;i++)locations[i].visible=!0}function clearMarkers(){setMapOnAll(null)}function getFromAddress(i){for(var e=0,s=locations.length;s>e;e++)if(i===locations[e].address)return e}function getFromMarkers(i){for(var e=0,s=markers.length;s>e;e++)if(i===markers[e].title)return e}function createInfoConent(i){var e="https://maps.googleapis.com/maps/api/streetview?size=600x400&location="+i+","+hood,s=getFromAddress(i),t='<div id="infoContent"><img class="bgimg" src="'+e+'"><h3 id="infoHeading" class="infoHeader">'+i+", "+hood+'</h3><div id="infoBody" class="infoBody">'+locations[s].description+'</div><h4>Wikipedia Link</h4><p id="wikipedia-links"></p></div>';return t}function getWiki(i){var e=getFromAddress(i.title);$.ajax({url:"https://en.wikipedia.org/w/api.php?action=opensearch&search="+locations[e].description+"&format=json&callback=wikiCallback",dataType:"jsonp",success:function(i){var e=i[1];if(0===e.length)$("#wikipedia-links").text("No article in wikipedia");else{var s="https://en.wikipedia.org/wiki/"+e[0];$("#wikipedia-links").append('<a href="'+s+'">'+s+"<a>")}}})}function createMapMarker(i){var e=new google.maps.Marker({map:map,position:i.geometry.location,animation:google.maps.Animation.DROP,title:i.name});markers.push(e);var s=createInfoConent(i.name),t=new google.maps.InfoWindow({content:s,maxWidth:maxwidth});google.maps.event.addListener(e,"click",function(){getWiki(e),e.setAnimation(google.maps.Animation.BOUNCE),t.open(map,e),setTimeout(function(){e.setAnimation(null)},2e3)})}function callback(i,e){e==google.maps.places.PlacesServiceStatus.OK&&createMapMarker(i[0])}function pinPoster(i){var e=new google.maps.places.PlacesService(map);for(var s in i){if(i[s].visible===!0)var t={query:i[s].address+hood};e.textSearch(t,callback)}}var locations,map,hood="Mountain View, CA",markers=[],maxwidth=300;initMap();var PlacesViewModel=function(){this.items=ko.observableArray([]),this.itemToAdd=ko.observable(""),this.init=function(){this.items.push(locations[0].address),this.items.push(locations[1].address),this.items.push(locations[2].address),this.items.push(locations[3].address),this.items.push(locations[4].address)},this.clear=function(){for(var i in this.items)this.items.pop()},this.addItem=function(){if(clearMarkers(),this.clear(),""!=this.itemToAdd())for(var i=0;i<locations.length;i++){var e=this.itemToAdd().toString(),s=locations[i].address.search(new RegExp(e,"i"));-1!=s?(this.items.push(locations[i].address),locations[i].visible=!0):locations[i].visible=!1}else this.init(),clearLocs();setMapOnAll(map)}.bind(this),this.showInfo=function(){var i=$("#filter-box option:selected")[0].text,e=getFromMarkers(i),s=createInfoConent(i),t=new google.maps.InfoWindow({content:s,maxWidth:maxwidth});t.open(map,markers[e]),getWiki(markers[e])},this.init()};ko.applyBindings(new PlacesViewModel);